import{c as b,j as e,r as l,f as ae,a as se,W as re,B as v,T as u,b as w,d as ne,e as te,g as le,h as B,i as t,k as ie,A as D,l as E,I as y,D as oe,m as de,n as ue,F as T,o as q,S as R,M as m,p as ce,q as me,s as he,u as ge,t as fe}from"./index-Ba3kxR0R.js";const xe=b(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),pe=b(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),je=b([e.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),e.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera"),ve=()=>{const[k,M]=l.useState([]),[C,L]=l.useState(""),[x,U]=l.useState(0),[h,N]=l.useState(10),[O,S]=l.useState(!1),[o,p]=l.useState(!1),[z,P]=l.useState(null),[H,g]=l.useState(null),[$,Q]=l.useState([]),[s,c]=l.useState({username:"",password:"",role:"user",user_firstname:"",user_middlename:"",user_lastname:"",user_office:"",user_email:"",user_image:null}),[j,V]=l.useState(null);l.useEffect(()=>{(async()=>{try{const r=await me();V(r)}catch(r){console.error("Failed to fetch current user",r)}})(),f()},[]),l.useEffect(()=>{G()},[]);const G=async()=>{const a=await ae();Q(a)};l.useEffect(()=>{f()},[]);const f=async()=>{try{const a=await se();M(a)}catch(a){console.error("Error fetching users:",a)}},J=async a=>{if(window.confirm("Are you sure you want to delete this user?"))try{await he(a),f()}catch(r){console.error("Error deleting user:",r),alert("Failed to delete the user.")}},K=a=>{L(a.target.value)},X=(a,r)=>{U(r)},Y=a=>{N(parseInt(a.target.value,10)),U(0)},I=(a=null)=>{a?(p(!0),P(a.id),c({username:a.username,password:"",role:a.role,user_firstname:a.user_firstname,user_middlename:a.user_middlename,user_lastname:a.user_lastname,user_office:a.user_office,user_email:a.user_email,user_image:a.user_image,barangay:a.barangay_id}),g(a.user_image?E(a.user_image):"/default-avatar.png")):(p(!1),c({username:"",password:"",role:"user",user_firstname:"",user_middlename:"",user_lastname:"",user_office:"",user_email:"",user_image:null,barangay:null}),g("/default-avatar.png")),S(!0)},_=()=>{S(!1),p(!1),P(null),g(null)},d=a=>{c({...s,[a.target.name]:a.target.value})},Z=a=>{const r=a.target.files[0];if(r){const i=new FileReader;i.onloadend=()=>{g(i.result),c({...s,user_image:r})},i.readAsDataURL(r)}},ee=async a=>{var r,i,W,A;a.preventDefault();try{const n=new FormData;if(n.append("username",s.username),n.append("role",s.role),n.append("user_firstname",s.user_firstname),n.append("user_middlename",s.user_middlename),n.append("user_lastname",s.user_lastname),n.append("user_office",s.user_office),n.append("user_email",s.user_email),n.append("barangay",s.barangay),!o&&s.password.trim()===""){alert("Password is required for new users!");return}s.password.trim()&&n.append("password",s.password),s.user_image instanceof File&&n.append("user_image",s.user_image),o?await ge(z,n):await fe(n),alert(o?"User updated successfully!":"User added successfully!"),f(),_()}catch(n){console.error("Error saving user:",((i=(r=n.response)==null?void 0:r.data)==null?void 0:i.error)||n.message),alert("Failed to save user: "+(((A=(W=n.response)==null?void 0:W.data)==null?void 0:A.error)||n.message))}},F=k.filter(a=>Object.entries(a).filter(([r])=>r!=="password").some(([r,i])=>i&&i.toString().toLowerCase().includes(C.toLowerCase())));return e.jsxs(re,{children:[e.jsxs(v,{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",mb:2,children:[e.jsx(u,{label:"Search User",variant:"outlined",size:"small",value:C,onChange:K,sx:{width:250}}),(j==null?void 0:j.role)==="admin"&&e.jsx(w,{variant:"contained",startIcon:e.jsx(xe,{}),onClick:()=>I(),sx:{whiteSpace:"nowrap"},children:"Add User"})]}),e.jsx(ne,{children:e.jsxs(te,{stickyHeader:!0,size:"medium",children:[e.jsx(le,{children:e.jsxs(B,{children:[e.jsx(t,{children:"Profile"}),e.jsx(t,{children:"Username"}),e.jsx(t,{children:"Full Name"}),e.jsx(t,{children:"Email"}),e.jsx(t,{children:"Office"}),e.jsx(t,{children:"Barangay"}),e.jsx(t,{children:"Role"}),e.jsx(t,{children:"Actions"})]})}),e.jsx(ie,{children:F.slice(x*h,x*h+h).map(a=>e.jsxs(B,{hover:!0,children:[e.jsx(t,{children:e.jsx(D,{src:a.user_image?E(a.user_image):"/default-avatar.png",alt:a.username})}),e.jsx(t,{children:a.username}),e.jsx(t,{children:`${a.user_firstname} ${a.user_middlename} ${a.user_lastname}`}),e.jsx(t,{children:a.user_email}),e.jsx(t,{children:a.user_office}),e.jsx(t,{children:a.barangay}),e.jsx(t,{children:a.role}),e.jsxs(t,{children:[e.jsx(y,{onClick:()=>I(a),children:e.jsx("img",{src:"/edit.svg",alt:"edit"})}),e.jsx(y,{color:"error",onClick:()=>J(a.id),children:e.jsx("img",{src:"/trash.svg",alt:"delete"})})]})]},a.id))})]})}),e.jsxs(oe,{open:O,onClose:_,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(de,{children:[o?"Edit User":"Add User",e.jsx(y,{onClick:_,style:{float:"right"},children:e.jsx(pe,{})})]}),e.jsx(ue,{dividers:!0,children:e.jsxs("form",{onSubmit:ee,children:[e.jsxs(v,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(D,{src:H,sx:{width:80,height:80}}),e.jsxs(w,{component:"label",variant:"contained",startIcon:e.jsx(je,{}),children:["Upload Image",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:Z})]})]}),e.jsx(u,{label:"Username",name:"username",value:s.username,onChange:d,fullWidth:!0,margin:"normal",required:!0,disabled:o}),e.jsx(u,{label:o?"New Password (Leave blank to keep current password)":"Password",name:"password",type:"password",value:s.password,onChange:d,fullWidth:!0,margin:"normal",required:!o}),e.jsx(u,{label:"First Name",name:"user_firstname",value:s.user_firstname,onChange:d,fullWidth:!0,margin:"normal",required:!0}),e.jsx(u,{label:"Middle Name",name:"user_middlename",value:s.user_middlename,onChange:d,fullWidth:!0,margin:"normal"}),e.jsx(u,{label:"Last Name",name:"user_lastname",value:s.user_lastname,onChange:d,fullWidth:!0,margin:"normal",required:!0}),e.jsx(u,{label:"Office",name:"user_office",value:s.user_office,onChange:d,fullWidth:!0,margin:"normal",required:!0}),e.jsx(u,{label:"Email",name:"user_email",type:"email",value:s.user_email,onChange:d,fullWidth:!0,margin:"normal",required:!0}),e.jsxs(T,{fullWidth:!0,margin:"normal",children:[e.jsx(q,{children:"Barangay"}),e.jsxs(R,{name:"barangay",value:s.barangay||"",onChange:a=>{const r=a.target.value===""?null:parseInt(a.target.value);c({...s,barangay:r})},required:!0,children:[e.jsx(m,{value:"",children:e.jsx("em",{children:"Select Barangay"})}),$.map(a=>e.jsx(m,{value:a.id,children:a.name},a.id))]})]}),e.jsxs(T,{fullWidth:!0,margin:"normal",children:[e.jsx(q,{children:"Role"}),e.jsxs(R,{name:"role",value:s.role,onChange:d,required:!0,children:[e.jsx(m,{value:"admin",children:"Admin"}),e.jsx(m,{value:"teacher",children:"Teacher"}),e.jsx(m,{value:"nutritionist",children:"Nutritionist"})]})]}),e.jsx(w,{type:"submit",variant:"contained",fullWidth:!0,sx:{mt:2},children:o?"Update User":"Add User"})]})})]}),e.jsx(v,{sx:{position:"absolute",bottom:0,right:0},children:e.jsx(ce,{rowsPerPageOptions:[10,20,100],component:"div",count:F.length,rowsPerPage:h,page:x,onPageChange:X,onRowsPerPageChange:Y})})]})};export{ve as default};
